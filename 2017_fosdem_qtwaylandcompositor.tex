\documentclass[ucs,9pt]{beamer}
% \documentclass[ucs,9pt,handout]{beamer}
\setbeamercovered{transparent}
\newcommand{\semitransp}[2][35]{\color{fg!#1}#2}

\usepackage[utf8x]{inputenc} % Set input encoding to UTF-8.
\usepackage[english]{babel} % Set language.
\usepackage{nicefrac}
\usepackage{courier}

% activate KDE theme
\usepackage{KDE/beamerthemeKDE}
\usepackage{tikz}
\usepackage{multicol}
\usepackage{listings}

\title[Device Tailored Wayland Compositors]{Device Tailored Compositors}
\subtitle{with the QtWayland-Compositor Framework}
\author{Andreas Cord-Landwehr}
\date{\textnormal{February 5, 2017\\[\medskipamount] FOSDEM, Brussels}}

\newcommand{\KDEemail}{cordlandwehr@kde.org}
% % % \newcommand{\KDEweb}{https://talks.cord-landwehr.de}
% % % \newcommand{\KDEaffiliation}{KDE Developer}
% % %

\lstset{ %
  language=C++,
  backgroundcolor=\color{KDEgray4},
  basicstyle=\footnotesize\ttfamily,
  breakatwhitespace=false,
  breaklines=true,
  captionpos=b,
  commentstyle=\color{KDEgreen},
  escapeinside={\%*}{*)},
  extendedchars=true,
  frame=single,
  keywordstyle=\color{KDEblue},
  language=Prolog,
  numbers=left,
  numbersep=5pt,
  numberstyle=\tiny\color{lightgray},
  rulecolor=\color{lightgray},
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  stepnumber=1,
  stringstyle=\color{KDEorange},
  tabsize=2,
  title=\lstname,
  morekeywords={Item,import,not,\},\{,Q_SIGNALS,public,Q_OBJECT,virtual,NOTIFY,Q_NULLPTR,Q_DISABLE_COPY,Q_DECL_OVERRIDE},
  deletekeywords={time}
}

%TikZ Definitions
\usetikzlibrary{arrows}
\usetikzlibrary{fit}
\usetikzlibrary{shadows}
\usetikzlibrary{patterns}
\usetikzlibrary{matrix}
\usetikzlibrary{shapes}
\usetikzlibrary{calc}
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{positioning}
\usetikzlibrary{backgrounds}
\usetikzlibrary{decorations}
\usetikzlibrary{decorations.pathreplacing}

\usepackage[variablett]{lmodern}

\newcommand*{\eswap}[3]{#1:[#2\rightarrow#3]}

\begin{document}
\maketitle

\begin{frame}
    {Introduction}
    {About Me \& the Talk}

    \begin{textblock*}{.4\paperwidth}[1,0](\paperwidth,0pt)%
        \includegraphics[width=\linewidth]{lexion.jpg}
    \end{textblock*}%

    \textbf{About Me}
    \begin{itemize}
        \item IRC-nick: CoLa
        \item KDE developer since $\approx$ 2010
        \item did PhD in algorithmic game theory\\ at Paderborn University \hspace{2.5cm}$\nearrow$
        \item now working as developer at CLAAS E-Systems in department for displays and operator panels for big agriculture machinery
    \end{itemize}
    \bigskip

    \textbf{This talk is about the QtWayland Compositor Framework:}
    \begin{enumerate}
        \item topic is between my KDE and my professional work
        \item practical introduction how to create your own compositor
        \item the talk shall make you eager to experiment with QtWaylandCompositor
        \item want to convince you that there is a new solution for many embedded device needs
    \end{enumerate}
\end{frame}

\usebackgroundtemplate{%
  \includegraphics[width=\paperwidth,height=\paperheight]{kitchen-device.png}}

\begin{frame}
    {The Red Thread}
    {Consider an embedded device for my kitchen\dots}
\end{frame}
\usebackgroundtemplate{}

\begin{frame}
    {Setting \& Requirements}

    \begin{textblock*}{.4\paperwidth}[1,0](\paperwidth,0pt)%
        \includegraphics[width=\linewidth]{kitchen-right.jpg}
    \end{textblock*}%

    \begin{itemize}
        \item powerful Linux based device with\\
            3D acceleration (e.g. Raspberry Pi)
        \item multi-application device:
            \begin{itemize}
                \item cooking eggs timer
                \item tea timer
                \item a game
            \end{itemize}
        \item animations and touch handling for changing applications
        \item seemless UI between the application windows
        \item [$\rightarrow$] we need a (Wayland) compositor
    \end{itemize}
    \bigskip

    \emph{Yes, the above can be reached in a much simpler way, but by exchanging the trivial apps with eg.\ internet radio, navigation system etc.\ and you get exactly what modern cars put onto their devices.}
\end{frame}

\begin{frame}
    {Interaction Concept for this Talk}
    {Something your designer might come up with}

    \begin{center}
        \includegraphics[width=.8\paperwidth]{interactionconcept.png}
    \end{center}
    \bigskip

    The remainder of the talk: how QtWayland helps to achieve this
\end{frame}

\begin{frame}
    {What was Wayland, again?}
    {A probably much too short answer for this question.}

    \begin{textblock*}{.2\paperwidth}[1,0](0.95\paperwidth,.05\paperheight)%
        \includegraphics[width=\linewidth]{wayland.png}
    \end{textblock*}%

    Wayland is a protocol specifying the communication between\\
    a compositor (display server) and its clients (applications with\\
    their windows)

    \begin{itemize}
        \item in the embedded world already established successor of X
        \item there are several compositor implementations:
            \begin{itemize}
                \item Weston: the reference implementation
                \item desktop environments: KWin, Mutter, Enlightment \dots
                \item some propriatary compositors by device vendors
            \end{itemize}
        \item via protocol extensions the Wayland protocol can provide new functionality:
            \begin{itemize}
                \item specified in XML files, code generated via wayland-scanner
            \end{itemize}
        \item available shells:
            \begin{itemize}
                \item [wl-shell] shell protocol provided with Wayland 1.0, in particulaly for desktop use cases (resizing, positioning, \dots)
                \item [xdg-shell] successor of wl\_shell
                \item [ivi-shell] the automotive world protocol (IVI = in-vehicle infotainment) for window placement
            \end{itemize}
    \end{itemize}
\end{frame}

\begin{frame}
    {The Qt Wayland Compositer API}

    \url{http://doc.qt.io/qt-5/qtwaylandcompositor-index.html}

    \begin{itemize}
        \item possible to write a compositor in just QML\\
            $\rightarrow$ QML is declarative language especially used for UI development on embedded devices/smartphones/touch applications
        \item supports Qt/C++ wrapper generation for Wayland protocol extensions
        \item supports multiple screen outputs
        \item provides wl-shell, xdg-shell and ivi-shell protocols
        \item History:
            \begin{itemize}
                \item since many years, there was an internal (but cumbersome to use) API
                \item Compositor API rewritten for Qt 5.7 (tech preview)
                \item Stable API since Qt 5.8 \alert{check if release happened until today :)}
            \end{itemize}
    \end{itemize}
    \medskip

    \textbf{Alternatives:} What about using the IVI-Shell extension?
    \begin{itemize}
        \item protocol only suited for very static settings
        \item Qt event loop handling not always well handled by off-the-shelf compositors
    \end{itemize}
\end{frame}

\begin{frame}
    {Possible System Architectures for my Kitchen Control}

    Components:
    \begin{description}
        \item [apps] Qt application running as Wayland client (with Qt: running on Wayland QPA with {\tt -platform wayland})
        \item [compositor] application acting as Wayland Server
        \item [shell] (optional, but IMO very reasonable) application that handles the more complex compositing logic and encapsulates all Wayland communication; eg. filters and sorts all safety relvant notifications from your applications
    \end{description}
    \medskip

    \begin{multicols}{2}
        \includegraphics[width=\linewidth]{architecture.png}
        \columnbreak

        \includegraphics[width=\linewidth]{architecture-shell.png}
    \end{multicols}

    Note: in this talk I will stick to the left variant
\end{frame}

\begin{frame}[fragile]
    {One-Slide Wayland Compositor}
    \vspace{-1em}
    \includegraphics[height=.8\paperheight]{OneSlideCompositor.png}
\end{frame}

\begin{frame}
    {Protocol Extension for Alarm Notifications}
    \alert{copy from demo}
\end{frame}

\begin{frame}
    {Demo}
\end{frame}

\begin{frame}
    {References}

    \begin{itemize}
        \item Johan's ``The Qt Wayland Compositor API'' introduction talk at QtCon 2016\\
            \url{https://conf.qtcon.org/en/qtcon/public/events/392}
        \item Online Help\\
            \url{http://doc.qt.io/qt-5/qtwaylandcompositor-index.html}
        \item IRC at freenode: \#qt-lighthouse
    \end{itemize}
\end{frame}

\KDElastframe

\end{document}
